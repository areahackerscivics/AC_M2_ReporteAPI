#!/usr/bin/env python
# encoding: utf-8

import sys, os
import datetime
import calendar
parent_dir=os.getcwd()
path= os.path.dirname(parent_dir)
sys.path.append(path)
import operator
from DAO.tweetClasificadoDAO import *

catColor = {
    "Turismo": "#BF1E2E",
    "Industria": "#EF4136",
    "Empleo": "#F25A29",
    "Seguridad": "#F8931F",
    "Hacienda": "#FCB042",
    "Salud": "#F9EE35",
    "Comercio": "#F9EE34",
    "Educación": "#D8DE24",
    "Vivienda": "#8DC641",
    "Ciencia y tecnología": "#272262",
    "Medio ambiente": "#2B3991",
    "Economía": "#29AAE3",
    "Transporte": "#01A79D",
    "Demografía": "#2BB673",
    "Deporte": "#016738",
    "Energía": "#009345",
    "Urbanismo e infraestructuras": "#3AB54B",
    "Sector público": "#672D93",
    "Legislación y justicia": "#92278F",
    "Cultura y ocio": "#9E1F64",
    "Sociedad y bienestar": "#DA1C5C",
    "Medio Rural": "#9B8578"
    }



def getEvolucionBLL(anyo, mes):
    """Devuelve la evolución de los tweets a lo largo del mes.

     Retorna  un diccionario con el  número de tweets por categoría
     En su proceso llama al  método que está en el DAO

     Parámetros:
     anyo: Año en el que fue creado el Tweet
     mes: Mes en el que fue creado el Tweet

     Nota:
     El return debe tener la forma {"Turismo": [x,x,x....n],..... "Seguridad": [x,..n]}
     porque es lo que se esta esperando como entrada en el Javascript

    """
    dicc = {
        'Ciencia y tecnología': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Comercio': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Cultura y ocio': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Demografía': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Deporte': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Economía': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Educación': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Empleo': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Energía': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Hacienda': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Industria': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Legislación y justicia': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Medio ambiente': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Medio Rural': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Salud': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Sector público': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Seguridad': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Sociedad y bienestar': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Transporte': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Turismo': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Urbanismo e infraestructuras': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        },
        'Vivienda': {
            '01': 0, '02': 0, '03': 0, '04': 0, '05': 0, '06': 0, '07': 0, '08': 0, '09': 0,
            '10': 0, '11': 0, '12': 0, '13': 0, '14': 0, '15': 0, '16': 0, '17': 0, '18': 0, '19': 0,
            '20': 0, '21': 0, '22': 0, '23': 0, '24': 0, '25': 0, '26': 0, '27': 0, '28': 0, '29': 0,
            '30': 0, '31': 0
        }
    }

    dicSumat = getTweetsClasificadosdias(anyo, mes)
    for tweet in dicSumat:
        categoria = (str(tweet['categoria'].encode('utf-8')))
        dia=tweet['dia']
        total=tweet['total']
        #se reemplaza en el diccionario el valor de cada día con el que está en la consulta
        dicc[categoria][dia] = total

    categoriasLista = dicc.keys()
    diasLista = dicc["Comercio"].keys()
    categoriasLista.sort()
    diasLista.sort()

    listaRes = []
    listaColor = []
    for categoria in categoriasLista:
        listaTemp = []
        listaTemp.append(categoria)
        for dia in diasLista:
            listaTemp.append(dicc[categoria][dia])

        listaRes.append(listaTemp)
        listaColor.append(catColor[categoria])

    resultado ={}
    resultado["resultado"]= listaRes
    resultado["color"]= listaColor
    return resultado





    # mesVacio = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    #
    # dicCat = {}
    # listaMes=[]
    # for dato in dicSumat:
    #     listaMes=[]
    #     categoria = (str(dato['categoria'].encode('utf-8')))
    #     pos = int(dato['dia'])-1
    #     total = int(dato['total'])
    #     print listaMes
    #     print dato
    #     if dicCat.has_key(categoria): #Repe
    #         listaMes = dicCat[categoria]
    #         print listaMes
    #         listaMes.pop(pos)
    #         print listaMes
    #         listaMes.insert(pos, total)
    #         print listaMes
    #         dicCat[categoria] = listaMes
    #     else: #Nuevo
    #         listaMes = mesVacio
    #         print "Vacio: ", mesVacio
    #         print listaMes
    #         listaMes.pop(pos)
    #         listaMes.insert(pos, total)
    #         dicCat[categoria] = listaMes
    #
    #     print dicCat
    #
    #
    # print dicCat
    # categoriasC = catColor.keys()
    # categoriasC.sort()
    #
    # respuesta = []
    # for categoria in categoriasC:
    #     arrayCat =[]
    #     arrayCat.append(categoria)
    #     if dicCat.has_key(categoria):
    #         arrayCat.extend(dicCat[categoria])
    #     else:
    #         arrayCat.extend(mesVacio)
    #     respuesta.append(arrayCat)
    #
    # resultado ={}
    # resultado["resultado"]= respuesta
    #
    # resultado = {"resultado": [
    # ["Turismo", 1, 0, 1, 2, 3, 2, 0, 2, 1, 0, 0, 0, 3, 2, 0, 3, 1, 0, 1, 1, 0, 0, 2, 0, 3, 2, 1, 1, 0, 0, 0],
    # ["Industria", 0, 0, 0, 0, 0, 0, 4, 0, 0, 1, 0, 0, 2, 3, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 4, 2, 0, 0, 1, 0],
    # ["Empleo", 0, 1, 0, 0, 4, 2, 3, 1, 0, 2, 0, 0, 1, 3, 1, 1, 1, 0, 0, 3, 2, 0, 2, 1, 0, 0, 0, 3, 0, 0, 0]
    # ]}
    # return resultado
